/*
 ** XDebugger - MIT License 2019
 ** Version v0 .0 .1 - April 2019
 ** Develop for Videsk™ by Matias Lopez
 */
const XDebugger=class{constructor(e){this._debug=e.debug||!1,this._log=e.log||!1,this._datatypes=e.types||["string","number","object"],this.logged=[],this._action=e.action,this._default=e.default||{},this._max=e.max||{length:-1,size:2e3},this.filters(),this.init()}log(e){(e=e||{}).time=e.time?e.time:(new Date).toString(),e.timestamp=e.timestamp?e.timestamp:(new Date).getTime(),Object.keys(this._default).length>0&&Object.keys(this._default).map(async t=>{e[t]=await this.checker(this._default[t],e=>this._default[t])}),this._debug&&this._log&&this.view(e),this._debug&&(this.logged.length<=this._max.length||-1===this._max.length)&&this.logged.push(e),"function"==typeof this._action&&this._debug&&this._action(e),this._log||setTimeout(()=>console.clear(),100)}view(e){function t(e){console.error("⚠ New error captured, see more info in the follow table ↓"),console.table(e)}e instanceof Array?e.map(e=>{t(e)}):e instanceof Object&&t(e)}clean(){this.logged=[]}search(e){const t=[];return"object"==typeof e&&Object.keys(e).length>0&&Object.keys(e).map(i=>{const o=this.checker(e[i]),n=Object.keys(e[i])[0]||null,s="object"===o&&window[n]||window.$eq,l={key:i,value:"object"===o?e[i][n]:e[i]};(t.length>0?t:this.logged).map(async e=>{const i=await s(e,l);Object.keys(i).length>0&&t.push(i)})}),t}export(e){e=e||this.logged;const t=document.createElement("a"),i=e.id||Math.random().toString(36).substr(2,5),o=e.logs||this.logged,n=new Date,s=e.name||`xdebugger_${n.getMonth()}-${n.getDate()}-${n.getFullYear()}_${i}`;t.href=URL.createObjectURL(new Blob([JSON.stringify(o)],{json:"text/json"})),t.download=`${s}.json`,t.click()}init(){this._log||(window.console.log=function(){return"Developer mode is disabled."},window.console.error=function(){return"Developer mode is disabled."},window.console.table=function(){return"Developer mode is disabled."},window.console.warn=function(){return"Developer mode is disabled."},window.console.info=function(){return"Developer mode is disabled."})}checker(e,t){this.checkSize(e,i=>{if(i<=this._max.size){const i=typeof e;if(this._datatypes.includes(i)){if("function"!=typeof t)return i;t(i)}else!this._datatypes.includes(i)&&this._debug&&(this._log&&(console.error("Only allows the following types ↓"),console.table(this._datatypes)),this.log({message:`${e} is not a valid data type`,code:150,explanation:`The variable was evaluated and is not valid, typeof ${e}: ${typeof e}.`,response:`Change to ${this._datatypes.toString()} data type.`,error:`Value expect a ${this._datatypes.toString()} and recieve ${typeof e}`}))}else this.log({message:"Value error is to big",code:150,explanation:`The error is too big, the size is ${i} MB max allowed is ${this._max.size} MB.`,response:`Change to less than ${this._max.size} MB.`,error:`[Error is to big to display] Not allowed value size, is bigger than ${this._max.size} MB`})})}filters(){window.$eq=((e,t)=>e[t.key]===t.value?e:{}),window.$cnt=((e,t)=>e[t.key].includes(t.value)?e:{}),window.$lte=((e,t)=>{let i=null;return"number"==typeof t.value&&(i=e[t.key]<=t.value?e:{}),i}),window.$lt=((e,t)=>{let i=null;return"number"==typeof t.value&&(i=e[t.key]<t.value?e:{}),i}),window.$gt=((e,t)=>{let i=null;return"number"==typeof t.value&&(i=e[t.key]>t.value?e:{}),i}),window.$gte=((e,t)=>{let i=null;return"number"==typeof t.value&&(i=e[t.key]>=t.value?e:{}),i})}onerror(e,t,i,o,n){return{message:e,url:t,file:t.substring(t.lastIndexOf("/")+1)||"undefinied",line:i,column:o||"-",error:n.message||n||"undefinied",clean:!0}}checkSize(e,t){let i=0;const o=function(e){return e/1048576}(function e(t){if(null!=t)switch(typeof t){case"number":i+=8;break;case"string":i+=2*t.length;break;case"boolean":i+=4;break;case"object":var o=Object.prototype.toString.call(t).slice(8,-1);if("Object"===o||"Array"===o)for(var n in t)t.hasOwnProperty(n)&&e(t[n]);else i+=2*t.toString().length}return i}(e));if("function"!=typeof t)return o;t(o)}};